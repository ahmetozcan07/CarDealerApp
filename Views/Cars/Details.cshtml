@model CarDealerApp.Models.Car

@{
    ViewData["Title"] = $"{Model.Make} {Model.Model}";
    var inquiries = ViewBag.Inquiries as List<CarDealerApp.Models.Inquiry>;
}
<div class="row">
    <div class="col-md-6">
        @if (!string.IsNullOrEmpty(Model.ImagePath))
        {
            <img src="@Model.ImagePath" class="img-fluid" />
        }
    </div>
    <div class="col-md-6">
        <h2>@Model.Make @Model.Model (@Model.Year)</h2>
        <p>@Model.Description</p>
        <p><strong>Price: </strong>@Model.Price.ToString("C")</p>

 


        <h4>Send Inquiry</h4>
        <form method="post" asp-action="SubmitInquiry" asp-controller="Cars">
            <input type="hidden" name="CarId" value="@Model.Id" />
            <div class="mb-2">
                <input class="form-control" name="Name" placeholder="Your Name" required />
            </div>
            <div class="mb-2">
                <input type="email" class="form-control" name="Email" placeholder="Your Email" required />
            </div>
            <div class="mb-2">
                <textarea class="form-control" name="Message" placeholder="Your Message" required></textarea>
            </div>
            <button class="btn btn-primary" type="submit">Send Inquiry</button>
        </form>
        <h3>Inquiries</h3>
        @if (inquiries == null || !inquiries.Any())
        {
            <p>No inquiries yet.</p>
        }
        else
        {
            <ul>
                @foreach (var i in inquiries)
                {
                    <li><strong>@i.Name:</strong> @i.Message</li>
                }
            </ul>
        }

        <div id="inquiryResult" class="mt-2"></div>
    </div>

</div>

@section Scripts {
    <script>
        async function sendInquiry() {
            const payload = {
                carId: parseInt(document.getElementById('carId').value),
                name: document.getElementById('name').value,
                email: document.getElementById('email').value,
                message: document.getElementById('message').value
            };
            const res = await fetch('/api/inquiries', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            if (res.ok) {
                document.getElementById('inquiryResult').innerHTML = '<div class="alert alert-success">Inquiry sent!</div>';
            } else {
                document.getElementById('inquiryResult').innerHTML = '<div class="alert alert-danger">Failed to send.</div>';
            }
        }
    </script>
}